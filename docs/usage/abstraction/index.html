<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Abstraction # In this section, we go through the abstraction layer and what needs to be implemented in order for this API to work.
Node ID # You should make a decision about size of your node IDs. This API supports Integer, Long and BigInteger by default. How a node ID is chosen can completely be different per use case. For example, this article suggests why it&rsquo;s a good idea to have the hash of your node&rsquo;s public key as your Node ID."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Abstraction"><meta property="og:description" content="Abstraction # In this section, we go through the abstraction layer and what needs to be implemented in order for this API to work.
Node ID # You should make a decision about size of your node IDs. This API supports Integer, Long and BigInteger by default. How a node ID is chosen can completely be different per use case. For example, this article suggests why it&rsquo;s a good idea to have the hash of your node&rsquo;s public key as your Node ID."><meta property="og:type" content="article"><meta property="og:url" content="https://ep2p.github.io/kademlia-api/docs/usage/abstraction/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-12-23T12:55:15+03:30"><title>Abstraction | EP2P | Kademlia API</title><link rel=manifest href=/kademlia-api/manifest.json><link rel=icon href=/kademlia-api/favicon.png type=image/x-icon><link rel=stylesheet href=/kademlia-api/book.min.a82d7e77ceb134d151c4d7e381eeb30623fbd5a524d58c584d8716ecec0205bd.css integrity="sha256-qC1+d86xNNFRxNfjge6zBiP71aUk1YxYTYcW7OwCBb0=" crossorigin=anonymous><script defer src=/kademlia-api/flexsearch.min.js></script>
<script defer src=/kademlia-api/en.search.min.a47441a480159b1b40ed16c0a57a10158a7caecf6d1aa145a00d03ca9aafa045.js integrity="sha256-pHRBpIAVmxtA7RbApXoQFYp8rs9tGqFFoA0DypqvoEU=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/kademlia-api/><span>EP2P | Kademlia API</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/kademlia-api/><strong>Introduction</strong></a></li><li>Usage<ul><li><a href=/kademlia-api/docs/usage/abstraction/ class=active>Abstraction</a></li><li><a href=/kademlia-api/docs/usage/kademlia-usage/>Kademlia Nodes</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/kademlia-api/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Abstraction</strong>
<label for=toc-control><img src=/kademlia-api/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#node-id>Node ID</a></li><li><a href=#connection-info>Connection Info</a></li><li><a href=#node>Node</a></li><li><a href=#routingtable>RoutingTable</a></li><li><a href=#protocol>Protocol</a><ul><li><a href=#kademlia-message>Kademlia Message</a></li><li><a href=#message-sender>Message Sender</a></li><li><a href=#custom-message-handler>Custom Message handler</a></li></ul></li><li><a href=#key-hash-generator>Key Hash Generator</a></li><li><a href=#kademlia-repository>Kademlia Repository</a></li></ul></nav></aside></header><article class=markdown><h1 id=abstraction>Abstraction
<a class=anchor href=#abstraction>#</a></h1><p>In this section, we go through the abstraction layer and what needs to be implemented in order for this API to work.</p><h2 id=node-id>Node ID
<a class=anchor href=#node-id>#</a></h2><p>You should make a decision about size of your node IDs. This API supports <code>Integer</code>, <code>Long</code> and <code>BigInteger</code> by default.
How a node ID is chosen can completely be different per use case.
For example, <a href=https://medium.com/coinmonks/a-brief-overview-of-kademlia-and-its-use-in-various-decentralized-platforms-da08a7f72b8f>this article</a> suggests why it&rsquo;s a good idea to have the hash of your node&rsquo;s public key as your Node ID.</p><h2 id=connection-info>Connection Info
<a class=anchor href=#connection-info>#</a></h2><p>This is just a <code>Serializable</code> interface that determines how nodes can communicate with each other. For example, one implementation can be a simple <code>ip</code> and <code>port</code> of a TCP socket.</p><h2 id=node>Node
<a class=anchor href=#node>#</a></h2><p>Each kademlia node only sees other nodes as combination of <strong>Node ID</strong> and <strong>Connection Info</strong>.</p><h2 id=routingtable>RoutingTable
<a class=anchor href=#routingtable>#</a></h2><p><code>RoutingTable</code> and its buckets are Serializable. So you will easily be able to write it to a file.
When you are creating an instance of your node, you can pass a new routing table or use one from disk.
At this stage, there is no helper class for writing routing table on disk.</p><p>You can get proper implementation of routing table based on the ID type of your nodes. Available ones are: <code>BigIntegerRoutingTable</code>, <code>LongRoutingTable</code> and <code>IntegerRoutingTable</code>.</p><h2 id=protocol>Protocol
<a class=anchor href=#protocol>#</a></h2><h3 id=kademlia-message>Kademlia Message
<a class=anchor href=#kademlia-message>#</a></h3><p>These are objects that represent a message that should be sent and delivered to other nodes.
The default package where messages exist is <code>io.ep2p.kademlia.protocol.message</code>.
Each message has certain type of serializable data attached to it, and it includes repliers&rsquo; <code>Node</code> and status of the replier (if it&rsquo;s alive or not).</p><p>Each message has a type as well, which helps you during the serialization/deserialization process to determine which object should be created from the message.</p><table><thead><tr><th>Type</th><th>KademliaMessage Class</th><th>Purpose</th></tr></thead><tbody><tr><td>EMPTY</td><td>EmptyKademliaMessage</td><td>Just proves another message was delivered/accepted</td></tr><tr><td>PING</td><td>PingKademliaMessage</td><td>Ping data to be sent to other nodes</td></tr><tr><td>PONG</td><td>PongKademliaMessage</td><td>Ping response</td></tr><tr><td>FIND_NODE_REQ</td><td>FindNodeRequestMessage</td><td>Request to find nodes close to current node</td></tr><tr><td>FIND_NODE_RES</td><td>FindNodeResponseMessage</td><td>Response to find node request</td></tr><tr><td>SHUTDOWN</td><td>ShutdownKademliaMessage</td><td>To tell other nodes that current node is shutting down</td></tr><tr><td>DHT_LOOKUP</td><td>DHTLookupKademliaMessage</td><td>Lookup for data in DHT</td></tr><tr><td>DHT_LOOKUP_RESULT</td><td>DHTLookupResultKademliaMessage</td><td>Result of lookup in DHT</td></tr><tr><td>DHT_STORE</td><td>DHTStoreKademliaMessage</td><td>Store data in DHT</td></tr><tr><td>DHT_STORE_RESULT</td><td>DHTStoreResultKademliaMessage</td><td>Result of storing data in DHT</td></tr></tbody></table><h3 id=message-sender>Message Sender
<a class=anchor href=#message-sender>#</a></h3><p>This is the networking layer. Should be implemented to send message (<code>KademliaMessage</code>) from the <code>caller</code> kademlia-node to <code>receiver</code> node.
Serialization, Validation, and request sending are the basic things that shall be done here.
The output of the API call probably has a response which should still be converted to the proper <code>KademliaMessage</code> and returned to the caller.</p><h3 id=custom-message-handler>Custom Message handler
<a class=anchor href=#custom-message-handler>#</a></h3><p>In case you want to extend the protocol or change behaviours, you should add new or extend messages, and write custom <a href=https://github.com/ep2p/kademlia-api/blob/main/src/main/java/io/ep2p/kademlia/protocol/handler/MessageHandler.java>handlers</a>.
You can then register your message handler on your <code>KademliaNodes</code> using <a href=https://github.com/ep2p/kademlia-api/blob/3d37f08cee9687471e18779b051aef19389215b4/src/main/java/io/ep2p/kademlia/node/KademliaNodeAPI.java#L68><code>kademliaNode.registerMessageHandler(type, handler)</code></a></p><h2 id=key-hash-generator>Key Hash Generator
<a class=anchor href=#key-hash-generator>#</a></h2><p>The purpose of <a href=https://github.com/ep2p/kademlia-api/blob/3d37f08cee9687471e18779b051aef19389215b4/src/main/java/io/ep2p/kademlia/node/KeyHashGenerator.java><code>KeyHashGenerator</code></a> interface is to bound DHT key size to network GUID size.</p><p>For example: when node IDs are <code>BigInteger</code> but DHT keys are <code>String</code>, a <code>KeyHashGenerator</code> implementation is needed to return hash of the <code>String</code> key as <code>BigInteger</code> value.</p><h2 id=kademlia-repository>Kademlia Repository
<a class=anchor href=#kademlia-repository>#</a></h2><p>This is simply DHT repository where keys and values are stored.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#node-id>Node ID</a></li><li><a href=#connection-info>Connection Info</a></li><li><a href=#node>Node</a></li><li><a href=#routingtable>RoutingTable</a></li><li><a href=#protocol>Protocol</a><ul><li><a href=#kademlia-message>Kademlia Message</a></li><li><a href=#message-sender>Message Sender</a></li><li><a href=#custom-message-handler>Custom Message handler</a></li></ul></li><li><a href=#key-hash-generator>Key Hash Generator</a></li><li><a href=#kademlia-repository>Kademlia Repository</a></li></ul></nav></div></aside></main></body></html>