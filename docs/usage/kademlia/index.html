<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kademlia Usage # In this section, we see how to create your Kademlia Nodes. Make sure you have read abstraction layer first.
Introduction # This library has 2 Kademlia related interfaces.
KademliaNodeAPI: Main implementation is KademliaNode class. It only handles bootstrapping the network and keeping it alive. KademliaDHTNodeAPI: Extends KademliaNodeAPI interface. Main implementation is KademliaDHTNode which decorates any KademliaNodeAPI. Therefore, to create KademliaDHTNode you first need an instance of KademliaNodeAPI (KademliaNode)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Kademlia"><meta property="og:description" content="Kademlia Usage # In this section, we see how to create your Kademlia Nodes. Make sure you have read abstraction layer first.
Introduction # This library has 2 Kademlia related interfaces.
KademliaNodeAPI: Main implementation is KademliaNode class. It only handles bootstrapping the network and keeping it alive. KademliaDHTNodeAPI: Extends KademliaNodeAPI interface. Main implementation is KademliaDHTNode which decorates any KademliaNodeAPI. Therefore, to create KademliaDHTNode you first need an instance of KademliaNodeAPI (KademliaNode)."><meta property="og:type" content="article"><meta property="og:url" content="https://ep2p.github.io/kademlia-api/docs/usage/kademlia/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-12-23T12:55:15+03:30"><title>Kademlia | EP2P | Kademlia API</title><link rel=manifest href=/kademlia-api/manifest.json><link rel=icon href=/kademlia-api/favicon.png type=image/x-icon><link rel=stylesheet href=/kademlia-api/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/kademlia-api/flexsearch.min.js></script>
<script defer src=/kademlia-api/en.search.min.439c6fb9a6df3adcdeac9173ab36426a9cc63fafe3176ac136376167dabe127f.js integrity="sha256-Q5xvuabfOtzerJFzqzZCapzGP6/jF2rBNjdhZ9q+En8=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/kademlia-api/><span>EP2P | Kademlia API</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/kademlia-api/><strong>Introduction</strong></a></li><li>Usage<ul><li><a href=/kademlia-api/docs/usage/abstraction/>Abstraction</a></li><li><a href=/kademlia-api/docs/usage/kademlia/ class=active>Kademlia Nodes</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/kademlia-api/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Kademlia</strong>
<label for=toc-control><img src=/kademlia-api/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#kademlia-node>Kademlia Node</a><ul><li><a href=#generics>Generics</a></li></ul></li><li><a href=#dht-kademlia-node>DHT Kademlia Node</a></li><li><a href=#settings>Settings</a></li><li><a href=#republishing-keys>Republishing Keys</a></li></ul></nav></aside></header><article class=markdown><h1 id=kademlia-usage>Kademlia Usage
<a class=anchor href=#kademlia-usage>#</a></h1><p>In this section, we see how to create your Kademlia Nodes. Make sure you have read <a href=/kademlia-api/docs/usage/abstraction/>abstraction layer</a> first.</p><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>This library has 2 Kademlia related <em>interfaces</em>.</p><ul><li><code>KademliaNodeAPI</code>: Main implementation is <code>KademliaNode</code> class. It only handles bootstrapping the network and keeping it alive.</li><li><code>KademliaDHTNodeAPI</code>: <em>Extends</em> <code>KademliaNodeAPI</code> interface. Main implementation is <code>KademliaDHTNode</code> which <a href=https://en.wikipedia.org/wiki/Decorator_pattern><em>decorates</em></a> any <code>KademliaNodeAPI</code>.</li></ul><p>Therefore, to create <code>KademliaDHTNode</code> you first need an instance of <code>KademliaNodeAPI</code> (<code>KademliaNode</code>).</p><p>It&rsquo;s not as complicated as it may sound. Read below.</p><h2 id=kademlia-node>Kademlia Node
<a class=anchor href=#kademlia-node>#</a></h2><p>For only network bootstrapping and continues routing-table updates you can consider using default <code>KademliaNodeAPI (interface)</code> implementation: <code>KademliaNode (impelementation)</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> io.ep2p.kademlia.node.KademliaNodeAPI<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.ep2p.kademlia.node.KademliaNode<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KademliaNodeAPI<span style=color:#f92672>&lt;</span>ID<span style=color:#f92672>,</span> C<span style=color:#f92672>&gt;</span> node <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> KademliaNode<span style=color:#f92672>&lt;&gt;(</span>id<span style=color:#f92672>,</span> connectionionInfo<span style=color:#f92672>,</span> routingTable<span style=color:#f92672>,</span> messageSenderAPI<span style=color:#f92672>,</span> nodeSettings<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>You can start the node by calling <code>start()</code> method, or you can bootstrap it by calling <code>bootstrap(bootstrapNode)</code> method and pass <code>Node&lt;ID, C></code> of bootstrap node as the parameter.</p><p>You can stop the node by calling <code>stop()</code> method which should gracefully stop the node and its executor services, or you can stop it by calling <code>stopNow()</code> method which will immediately the running jobs.</p><h3 id=generics>Generics
<a class=anchor href=#generics>#</a></h3><p>Note that KademliaNode and all its subclasses are Generic.</p><p>The first generic type is for ID of the node, and you can choose between <code>Integer</code>, <code>Long</code>, <code>BigInteger</code> as these are the only ones supported and you should decide on which on to use based on your GUID space size. For example on <strong>Eleuth Node System</strong> Biginteger is being used since node IDs are <code>SHA1</code> of a public keys. You can <a href=https://github.com/ep2p/kademlia-api/tree/main/src/main/java/io/ep2p/kademlia/table>choose the appropriate <code>RoutingTable</code></a> implementation based on this key size. There is an implementation available for all of the three supported ID types.</p><p>The second generic type is type of your class that implements <code>ConnectionInfo</code>.</p><h2 id=dht-kademlia-node>DHT Kademlia Node
<a class=anchor href=#dht-kademlia-node>#</a></h2><p>For <strong>Distributed Hash Table</strong> you should consider using <code>DHTKademliaNodeAPI</code> interface. The main implementation is <code>DHTKademliaNode</code> class.</p><p>This class decorates <code>KademliaNodeAPI</code> as explained earlier. So you can instantiate it in 2 ways.</p><p>A. Using constructor:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>new</span> DHTKademliaNode<span style=color:#f92672>&lt;&gt;(</span>kademliaNodeAPI<span style=color:#f92672>,</span> keyHashGenerator<span style=color:#f92672>,</span> kademliaRepository<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>B. Using builder:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>new</span> DHTKademliaNodeBuilder<span style=color:#f92672>&lt;&gt;(</span>id<span style=color:#f92672>,</span> connectionInfo<span style=color:#f92672>,</span> routingTable<span style=color:#f92672>,</span> messageSenderAPI<span style=color:#f92672>,</span> keyHashGenerator<span style=color:#f92672>,</span> kademliaRepository<span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h2 id=settings>Settings
<a class=anchor href=#settings>#</a></h2><p>You can configure your node by passing an instance of <code>NodeSettings</code> to <code>KademliaNode</code> or it&rsquo;s subclasses.
By default, they use the configuration from <code>NodeSettings.Default</code> which has static fields. You can edit <code>NodeSettings.Default</code> if all the nodes that you want to have in a single application are having the same configuration.</p><p>Node Settings explanation:</p><table><thead><tr><th>Name</th><th>Info</th></tr></thead><tbody><tr><td>IDENTIFIER_SIZE</td><td>GUID Space AKA Routing table buckets count</td></tr><tr><td>BUCKET_SIZE</td><td>Max size of each bucket in routing table</td></tr><tr><td>FIND_NODE_SIZE</td><td>Size of results list when finding close nodes</td></tr><tr><td>MAXIMUM_LAST_SEEN_AGE_TO_CONSIDER_ALIVE</td><td>Value in seconds. If a node is older than this age, we will ping it before sending messages</td></tr><tr><td>PING_SCHEDULE_TIME_VALUE</td><td>Value in <code>PING_SCHEDULE_TIME_UNIT</code> to send pings in scheduler</td></tr><tr><td>PING_SCHEDULE_TIME_UNIT</td><td>TimeUnit for ping scheduler</td></tr><tr><td>DHT_EXECUTOR_POOL_SIZE</td><td>Size of ExecutorService in DHT for default constructor</td></tr><tr><td>ENABLED_FIRST_STORE_REQUEST_FORCE_PASS</td><td>Enables force pass on first store loop. Has negative impact on performance but makes sure another node also tries to store. Useful in situations where a node doesn&rsquo;t know much about other nodes in the network</td></tr></tbody></table><h2 id=republishing-keys>Republishing Keys
<a class=anchor href=#republishing-keys>#</a></h2><p>In DHT we often require to republish keys. For example in a scenario where a node is shutting down there should be a mechanism for the node to republish its keys (and values) to other nodes before shutting down.
This way there won&rsquo;t be much data loss. Another scenario is when a new node joins the network, and we (as an individual node) may want to pass the data that the new node should hold to them.
Therefore, we should periodically republish our data so closer nodes hold it.</p><p>This kademlia-api does not implement key republishing since <code>4.0.0-RELEASE</code> version. This mechanism can be very tricky and very depended on how each developer implements their <code>KademliaRepository</code>.
For example, when a single key can hold large amount of data we&rsquo;d probably want to find a closer node first and then pass the data to them in different chunks.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#kademlia-node>Kademlia Node</a><ul><li><a href=#generics>Generics</a></li></ul></li><li><a href=#dht-kademlia-node>DHT Kademlia Node</a></li><li><a href=#settings>Settings</a></li><li><a href=#republishing-keys>Republishing Keys</a></li></ul></nav></div></aside></main></body></html>